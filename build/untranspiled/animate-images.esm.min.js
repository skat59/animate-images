/*!
 @its2easy/animate-images 2.3.1
 https://github.com/skat59/animate-images
         
 Copyright (c) 2020-present Dmitry Kovalev,
 Released under the MIT license
*/
function t(t,s){return(t=Math.floor(t))<=0?1:t>s?s:t}function s(t){return t.charAt(0).toUpperCase()+t.slice(1)}const i={preload:"all",preloadNumber:0,poster:!1,fps:30,loop:!1,autoplay:!1,reverse:!1,ratio:void 0,fillMode:"cover",draggable:!1,inversion:!1,dragModifier:1,touchScrollMode:"pageScrollTimer",pageScrollTimerDelay:1500,responsiveAspect:"width",fastPreview:!1,onFastPreloadFinished:e,onPreloadFinished:e,onPosterLoaded:e,onAnimationEnd:e,onBeforeFrame:e,onAfterFrame:e},h="animate-images:";function e(){}class r{constructor({settings:t,data:s,updateImagesCount:i,getFramesLeft:e}){if(this.t=t,this.i=s,this.h=i,this.o=e,this.l=!1,this.u=!1,this.m=!1,this.g=!1,this.p=0,this.v=0,this.F=[],this.M=[],this._="default",this.P={default:{images:this.t.images,event:h+"preload-finished",callback:this.t.onPreloadFinished},fast:{images:this.t?.fastPreview.images,event:h+"fast-preload-finished",callback:this.t.onFastPreloadFinished}},this.t.fastPreview){if(!this.t.fastPreview.images)throw new TypeError("fastPreview.images is required when fastPreview is enabled");this._="fast",this.i.totalImages=this.t.fastPreview.images.length}this.C=this.i.totalImages}A(t){if(this.l)return;t||(t=this.C),t=Math.round(t);const s=this.C-this.p;if(t>s&&(t=s),!(t<=0)){for(let s=this.p;s<t+this.p;s++){let t=new Image;t.onload=t.onerror=this.#t.bind(this),t.src=this.P[this._].images[s],this.F[s]=t}this.p=this.p+t}}#t(t){this.v++;const s=Math.floor(this.v/this.C*1e3)/1e3;if(this.i.canvas.element.dispatchEvent(new CustomEvent(h+"loading-progress",{detail:{progress:s}})),"error"===t.type){this.g=!0;const s=t.path||t.composedPath&&t.composedPath();this.M.push(s[0]),this.i.canvas.element.dispatchEvent(new Event(h+"loading-error"))}this.v>=this.C&&(this.g&&this.#s(),this.#i())}#s(){this.M.length<1||(this.F=this.F.filter((t=>!this.M.includes(t))))}#i(){"default"===this._?this.l=!0:this.u=!0,this.m=!0,this.i.loadedImagesArray=[...this.F],this.i.totalImages=this.F.length,this.h();const t=this._,s=this.i.pluginApi;if("fast"===this._)this._="default",this.F=[],this.p=this.v=0,this.C=this.t.images.length,this.i.deferredAction&&this.A();else if("default"===this._&&this.t.fastPreview){this.t?.fastPreview.fpsAfter&&s.setOption("fps",this.t?.fastPreview.fpsAfter);const t=s.isAnimating(),i=void 0!==this.o(),h=this.t?.fastPreview.matchFrame;s.setFrame(h?h(this.i.currentFrame):1),t&&!i&&s.play()}this.i.deferredAction&&(this.i.deferredAction(),this.i.deferredAction=null),this.i.canvas.element.dispatchEvent(new Event(this.P[t].event)),this.P[t].callback(s)}I(){this.t.fastPreview&&!this.l&&this.A()}}class a{constructor({settings:t,data:s}){this.t=t,this.i=s,this.D=this.i.canvas.element.getContext("2d")}T(t){let s,i,h,e,r,a,n,o;"cover"===this.t.fillMode?({sx:s,sy:i,sWidth:h,sHeight:e,dx:r,dy:a,dWidth:n,dHeight:o}=this.#h(t)):"contain"===this.t.fillMode&&({sx:s,sy:i,sWidth:h,sHeight:e,dx:r,dy:a,dWidth:n,dHeight:o}=this.#e(t));const d=this.i.canvas.element;this.t.onBeforeFrame(this.i.pluginApi,{context:this.D,width:d.width,height:d.height}),this.D.drawImage(t,s,i,h,e,r,a,n,o),this.t.onAfterFrame(this.i.pluginApi,{context:this.D,width:d.width,height:d.height})}S(){const t=this.i.canvas.element;this.D.clearRect(0,0,t.width,t.height)}#h(t){let s,i,h,e,r=this.i.canvas.element.width,a=this.i.canvas.element.height,n=t.naturalWidth,o=t.naturalHeight,d=Math.min(r/n,a/o),l=n*d,u=o*d,c=1;return l<r&&(c=r/l),Math.abs(c-1)<1e-14&&u<a&&(c=a/u),l*=c,u*=c,h=n/(l/r),e=o/(u/a),s=.5*(n-h),i=.5*(o-e),s<0&&(s=0),i<0&&(i=0),h>n&&(h=n),e>o&&(e=o),{sx:s,sy:i,sWidth:h,sHeight:e,dx:0,dy:0,dWidth:r,dHeight:a}}#e(t){let s,i,h=this.i.canvas.element.width,e=this.i.canvas.element.height,r=t.naturalWidth,a=t.naturalHeight,n=r,o=a,d=h/r,l=e/a,u=Math.min(d,l),c=r*u,m=a*u;return s=.5*(h-c),i=.5*(e-m),{sx:0,sy:0,sWidth:n,sHeight:o,dx:s,dy:i,dWidth:c,dHeight:m}}}class n{L;H;W;N;q;R;k;constructor({settings:t,data:s,changeFrame:i}){this.t=t,this.i=s,this.O=i,this.q=!1,this.L=!1,this.R=0,this.k=.35,this.B()}U(){this.L=!0,this.q=!1,this.i.isAnyFrameChanged||(this.O(1),Number.isFinite(this.H)&&this.H--),this.W=null,requestAnimationFrame(this.#r.bind(this))}X(){const t=this.L;this.L=!1,this.H=void 0,t&&(this.i.canvas.element.dispatchEvent(new Event(h+"animation-end")),this.t.onAnimationEnd(this.i.pluginApi))}Y(t,s){t=Math.floor(t),void 0===s&&(s=this.t.reverse);let i=s?this.i.currentFrame-t:this.i.currentFrame+t;return this.t.loop?i<=0?i=this.i.totalImages-Math.abs(i):i>this.i.totalImages&&(i-=this.i.totalImages):i<=0?(i=1,this.q=!0):i>this.i.totalImages&&(i=this.i.totalImages,this.q=!0),i}#r(t){if(!this.L)return;let s;this.W||(this.W=performance.now());let i=Math.abs(t-performance.now())/this.N>this.k,h=(t-this.W)/this.N;if(h>this.k&&(i=!0),i?s=1:(h<0&&(h=0),s=h*this.i.totalImages,s+=this.R),s>=1){const h=i?performance.now():t;this.R=s%1,s=Math.floor(s)%this.i.totalImages,s>this.H&&(s=this.H);const e=this.Y(s);this.q?(this.i.pluginApi.stop(),this.q=!1,this.i.pluginApi.getCurrentFrame()!==e&&this.O(e)):(this.W=h,this.O(e),void 0!==this.H&&(this.H=this.H-s,this.H<=0&&this.i.pluginApi.stop()))}this.L&&requestAnimationFrame(this.#r.bind(this))}B(){this.N=this.i.totalImages/this.t.fps*1e3}}class o{$;j;constructor({settings:t,data:s,drawFrame:i}){this.t=t,this.i=s,this.T=i,this.j=!1}G(){this.t.poster&&!this.i.isAnyFrameChanged&&(this.$=new Image,this.$.onload=this.$.onerror=this.#a.bind(this),this.$.src=this.t.poster)}J(){!this.i.isAnyFrameChanged&&this.j&&this.#n()}#a(t){"error"!==t.type&&(this.j=!0,this.i.canvas.element.dispatchEvent(new Event(h+"poster-loaded")),this.t.onPosterLoaded(this.i.pluginApi),this.i.isAnyFrameChanged||this.#n())}#n(){this.T(this.$)}}class d{K=!1;V;Z;tt;st;it;ht;et;rt;constructor({data:t,settings:s,changeFrame:i,getNextFrame:h}){this.i=t,this.t=s,this.O=i,this.Y=h,this.nt=["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"],this.K=!1,this.ot=this.#o.bind(this),this.ht=0,this.dt()}lt(){this.nt.forEach((t=>{this.i.canvas.element.addEventListener(t,this.ot)}))}ut(){this.nt.forEach((t=>{this.i.canvas.element.removeEventListener(t,this.ot)})),document.removeEventListener("mouseup",this.ot),document.removeEventListener("mousemove",this.ot),this.i.canvas.element.style.cursor=null}dt(t=null){this.it=t||this.i.canvas.element.clientWidth/this.i.totalImages}#o(t){let s;switch(void 0!==t.touches&&t.touches.length&&(s=t.touches),this.V=s?s[0].pageX:t.clientX,this.Z=s?s[0].pageY:t.clientY,t.type){case"mousedown":case"touchstart":"touchstart"===t.type&&t.cancelable&&this.#d(t),document.addEventListener("mouseup",this.ot),document.addEventListener("mousemove",this.ot),this.#l();break;case"mousemove":case"touchmove":const s=this.tt!==this.V&&this.st!==this.V;this.K&&s&&this.#u();break;case"mouseup":case"touchend":case"touchcancel":this.K&&(document.removeEventListener("mouseup",this.ot),document.removeEventListener("mousemove",this.ot),this.#c())}}#l(){const t=this.i.pluginApi;(t.isFastPreloadFinished()||t.isPreloadFinished())&&(this.t.fastPreview&&!t.isPreloadFinished()&&t.isFastPreloadFinished()&&t.preloadImages(),t.stop(),this.K=!0,this.i.canvas.element.style.cursor="grabbing",this.tt=this.V,this.st=this.Z,this.i.canvas.element.dispatchEvent(new CustomEvent(h+"drag-start",{detail:{frame:this.i.currentFrame}})))}#u(){const t=this.#m();this.rt&&this.rt!==t&&(this.ht=0),this.rt=t;const s=Math.abs(this.V-this.tt),i=(s+this.ht)*this.t.dragModifier;if(this.tt=this.V,this.st=this.Z,"left"!==t&&"right"!==t||i<this.it)return void(this.ht+=s);const e=i/this.i.canvas.element.clientWidth;let r=Math.floor(e*this.i.totalImages);r%=this.i.totalImages,this.ht=(i-this.it*r)/this.t.dragModifier;let a="left"===t;this.t.inversion&&(a=!a),this.O(this.Y(r,a)),this.i.canvas.element.dispatchEvent(new CustomEvent(h+"drag-change",{detail:{frame:this.i.currentFrame,direction:t}}))}#c(){this.V=this.Z=this.tt=this.st=null,this.K=!1,this.i.canvas.element.style.cursor=null,this.et=(new Date).getTime(),this.i.canvas.element.dispatchEvent(new CustomEvent(h+"drag-end",{detail:{frame:this.i.currentFrame,direction:this.rt}}))}#m(){let t,s,i=this.tt-this.V,h=this.st-this.Z;return t=Math.atan2(h,i),s=Math.round(180*t/Math.PI),s<0&&(s=360-Math.abs(s)),s>=0&&s<=60||s<=360&&s>=300?"left":s>=120&&s<=240?"right":s>=241&&s<=299?"bottom":"up"}#d(t){if("preventPageScroll"===this.t.touchScrollMode&&t.preventDefault(),"pageScrollTimer"===this.t.touchScrollMode){const s=(new Date).getTime();this.et&&s-this.et<this.t.pageScrollTimerDelay?t.preventDefault():this.et=null}}}class l{#g;#p={currentFrame:1,totalImages:null,loadedImagesArray:[],deferredAction:null,isAnyFrameChanged:!1,pluginApi:void 0,canvas:{element:null,ratio:null}};#f;#w;#v;#F;#M;#_;constructor(t,s){!function(t,s){if(!(t instanceof HTMLCanvasElement))throw new TypeError("node is required and should be canvas element");if(!s.images||!Array.isArray(s.images)||s.images.length<=1)throw new TypeError("options.images is required and must be an array with more than 1 element");"preloadNumber"in s&&(s.preloadNumber=Number.parseInt(s.preloadNumber)),"fillMode"in s&&!["cover","contain"].includes(s.fillMode)&&delete s.fillMode,"dragModifier"in s&&(s.dragModifier=Math.abs(+s.dragModifier))}(t,s),this.#g={...i,...s},this.#p.totalImages=this.#g.images.length,this.#p.canvas.element=t,this.#p.pluginApi=this,this.#f=this.#y.bind(this),this.#b()}#b(){if(this.#v=new a({settings:this.#g,data:this.#p}),this.#F=new n({settings:this.#g,data:this.#p,changeFrame:this.#P.bind(this)}),this.#y(),this.#g.poster&&this.#C(),this.#A(!0),this.#w=new r({settings:this.#g,data:this.#p,updateImagesCount:this.#x.bind(this),getFramesLeft:this.#E.bind(this)}),"all"===this.#g.preload||"partial"===this.#g.preload){let t="all"===this.#g.preload?this.#p.totalImages:this.#g.preloadNumber;0===t&&(t=this.#p.totalImages),this.#w.A(t)}this.#g.autoplay&&this.play(),this.#g.draggable&&this.#I(!0)}#P(t){t===this.#p.currentFrame&&this.#p.isAnyFrameChanged||(this.#p.isAnyFrameChanged||(this.#p.isAnyFrameChanged=!0),this.#D(t),this.#p.currentFrame=t)}#D(t){this.#v.S(),this.#v.T(this.#p.loadedImagesArray[t-1])}#y(){const t=this.#p.canvas;this.#g.ratio?t.ratio=this.#g.ratio:t.ratio||(t.ratio=t.element.width/t.element.height);const i=window.devicePixelRatio.toFixed(2)||1;let h=this.#g.responsiveAspect,e="client"+s(h),r="width"===h?"height":"width",a="client"+s(r);const n=t.element[e];t.element[h]=t.element[e]*i,n!==t.element[e]&&(t.element[h]=t.element[e]*i);let o="width"===h?t.element.clientWidth/t.ratio:t.element.clientHeight*t.ratio;t.element[r]=Math.round(o)*i;const d=Math.abs(t.element[r]-t.element[a]*i);if(d>i){let s=t.element.clientWidth/t.element.clientHeight;Math.abs(t.ratio-s)/t.ratio>.01?(t.element[r]=t.element[a]*i,t.ratio=s):t.element[r]="width"===h?t.element.width/t.ratio:t.element.height*t.ratio}else d>0&&d<=i&&(t.element[r]="width"===h?t.element.width/t.ratio:t.element.height*t.ratio);this.#_&&this.#_.dt(),this.#T()}#x(){this.#_&&this.#_.dt(),this.#F.B()}#T(){this.#p.isAnyFrameChanged?this.#D(this.#p.currentFrame):this.#M&&this.#M.J()}#I(t){t?(this.#_||(this.#_=new d({data:this.#p,settings:this.#g,changeFrame:this.#P.bind(this),getNextFrame:this.#F.Y.bind(this.#F)})),this.#_.lt()):this.#_&&this.#_.ut()}#C(){this.#M||(this.#M=new o({settings:this.#g,data:this.#p,drawFrame:this.#v.T.bind(this.#v)})),this.#M.G()}#A(t=!0){t?window.addEventListener("resize",this.#f):window.removeEventListener("resize",this.#f)}#E(){return this.#F.H}play(){return this.#F.L||(this.#w.m?(this.#F.U(),this.#w.I()):(this.#p.deferredAction=this.play.bind(this),this.#w.A())),this}stop(){return this.#F.X(),this}toggle(){return this.#F.L?this.stop():this.play(),this}next(){return this.#w.m?(this.stop(),this.#P(this.#F.Y(1)),this.#w.I()):(this.#p.deferredAction=this.next.bind(this),this.#w.A()),this}prev(){return this.#w.m?(this.stop(),this.#P(this.#F.Y(1,!this.#g.reverse)),this.#w.I()):(this.#p.deferredAction=this.prev.bind(this),this.#w.A()),this}setFrame(s){return this.#w.m?(this.stop(),this.#P(t(s,this.#p.totalImages)),this.#w.I()):(this.#p.deferredAction=this.setFrame.bind(this,s),this.#w.A()),this}playTo(s,i){s=t(s,this.#p.totalImages);const h=Math.abs(s-this.#p.currentFrame),e=this.#p.totalImages-h,r=this.#g.loop&&i?.shortestPath&&e<h;return r?s<this.#p.currentFrame?this.setReverse(!1):this.setReverse(!0):s>this.#p.currentFrame?this.setReverse(!1):this.setReverse(!0),this.playFrames(r?e:h)}playFrames(t=0){if(this.#w.m){if((t=Math.floor(t))<0)return this.stop();if(this.#p.isAnyFrameChanged||(t+=1),t<=0)return this.stop();this.#F.H=t,this.play(),this.#w.I()}else this.#p.deferredAction=this.playFrames.bind(this,t),this.#w.A();return this}setReverse(t=!0){return this.#g.reverse=!!t,this}getReverse(){return this.#g.reverse}setForward(t=!0){return this.#g.reverse=!t,this}preloadImages(t){return t=t??this.#g.images.length,this.#w.A(t),this}updateCanvas(){return this.#y(),this}getOption(t){if(t in this.#g)return this.#g[t];console.warn(`${t} is not a valid option`)}setOption(t,s){return["fps","loop","reverse","inversion","ratio","fillMode","draggable","dragModifier","touchScrollMode","pageScrollTimerDelay","onPreloadFinished","onFastPreloadFinished","onPosterLoaded","onAnimationEnd","onBeforeFrame","onAfterFrame"].includes(t)?(this.#g[t]=s,"fps"===t&&this.#F.B(),"ratio"===t&&this.#y(),"fillMode"===t&&this.#y(),"draggable"===t&&this.#I(s),"dragModifier"===t&&(this.#g.dragModifier=Math.abs(+s))):console.warn(`${t} is not allowed in setOption`),this}getCurrentFrame(){return this.#p.currentFrame}getTotalImages(){return this.#p.totalImages}getRatio(){return this.#p.canvas.ratio}isAnimating(){return this.#F.L}isDragging(){return!!this.#_&&this.#_.K}isPreloadFinished(){return this.#w.l}isFastPreloadFinished(){return this.#w.u}isLoadedWithErrors(){return this.#w.g}reset(){return this.#w.m?(this.stop(),this.#P(t(1,this.#p.totalImages)),this.#w.I()):(this.#p.deferredAction=this.reset.bind(this),this.#w.A()),this}destroy(){this.stop(),this.#v.S(),this.#I(!1),this.#A(!1)}}export{l as default};
//# sourceMappingURL=animate-images.esm.min.js.map
