/*!
 @its2easy/animate-images 2.3.1
 https://github.com/skat59/animate-images
         
 Copyright (c) 2020-present Dmitry Kovalev,
 Released under the MIT license
*/
function t(t,i,s){return i in t?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,t}function i(t,i){return function(t,i){if(i.get)return i.get.call(t);return i.value}(t,h(t,i,"get"))}function s(t,i,s){return function(t,i,s){if(i.set)i.set.call(t,s);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=s}}(t,h(t,i,"set"),s),s}function h(t,i,s){if(!i.has(t))throw new TypeError("attempted to "+s+" private field on non-instance");return i.get(t)}function e(t,i,s){if(!i.has(t))throw new TypeError("attempted to get private field on non-instance");return s}function n(t,i){if(i.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(t,i,s){n(t,i),i.set(t,s)}function r(t,i){n(t,i),i.add(t)}function o(t,i){return(t=Math.floor(t))<=0?1:t>i?i:t}function d(t){return t.charAt(0).toUpperCase()+t.slice(1)}const l={preload:"all",preloadNumber:0,poster:!1,fps:30,loop:!1,autoplay:!1,reverse:!1,ratio:void 0,fillMode:"cover",draggable:!1,inversion:!1,dragModifier:1,touchScrollMode:"pageScrollTimer",pageScrollTimerDelay:1500,responsiveAspect:"width",fastPreview:!1,onFastPreloadFinished:c,onPreloadFinished:c,onPosterLoaded:c,onAnimationEnd:c,onBeforeFrame:c,onAfterFrame:c},u="animate-images:";function c(){}var f=new WeakSet,v=new WeakSet,m=new WeakSet;class w{constructor(t){var i;let{settings:s,data:h,updateImagesCount:e,getFramesLeft:n}=t;if(r(this,m),r(this,v),r(this,f),this.t=s,this.i=h,this.h=e,this.o=n,this.l=!1,this.u=!1,this.v=!1,this.m=!1,this.g=0,this.p=0,this.M=[],this.W=[],this.k="default",this.F={default:{images:this.t.images,event:u+"preload-finished",callback:this.t.onPreloadFinished},fast:{images:null===(i=this.t)||void 0===i?void 0:i.fastPreview.images,event:u+"fast-preload-finished",callback:this.t.onFastPreloadFinished}},this.t.fastPreview){if(!this.t.fastPreview.images)throw new TypeError("fastPreview.images is required when fastPreview is enabled");this.k="fast",this.i.totalImages=this.t.fastPreview.images.length}this.S=this.i.totalImages}_(t){if(this.l)return;t||(t=this.S),t=Math.round(t);const i=this.S-this.g;if(t>i&&(t=i),!(t<=0)){for(let i=this.g;i<t+this.g;i++){let t=new Image;t.onload=t.onerror=e(this,f,g).bind(this),t.src=this.F[this.k].images[i],this.M[i]=t}this.g=this.g+t}}T(){this.t.fastPreview&&!this.l&&this._()}}function g(t){this.p++;const i=Math.floor(this.p/this.S*1e3)/1e3;if(this.i.canvas.element.dispatchEvent(new CustomEvent(u+"loading-progress",{detail:{progress:i}})),"error"===t.type){this.m=!0;const i=t.path||t.composedPath&&t.composedPath();this.W.push(i[0]),this.i.canvas.element.dispatchEvent(new Event(u+"loading-error"))}this.p>=this.S&&(this.m&&e(this,v,p).call(this),e(this,m,M).call(this))}function p(){this.W.length<1||(this.M=this.M.filter((t=>!this.W.includes(t))))}function M(){"default"===this.k?this.l=!0:this.u=!0,this.v=!0,this.i.loadedImagesArray=[...this.M],this.i.totalImages=this.M.length,this.h();const t=this.k,i=this.i.pluginApi;if("fast"===this.k)this.k="default",this.M=[],this.g=this.p=0,this.S=this.t.images.length,this.i.deferredAction&&this._();else if("default"===this.k&&this.t.fastPreview){var s,h,e;null!==(s=this.t)&&void 0!==s&&s.fastPreview.fpsAfter&&i.setOption("fps",null===(h=this.t)||void 0===h?void 0:h.fastPreview.fpsAfter);const t=i.isAnimating(),n=void 0!==this.o(),a=null===(e=this.t)||void 0===e?void 0:e.fastPreview.matchFrame;i.setFrame(a?a(this.i.currentFrame):1),t&&!n&&i.play()}this.i.deferredAction&&(this.i.deferredAction(),this.i.deferredAction=null),this.i.canvas.element.dispatchEvent(new Event(this.F[t].event)),this.F[t].callback(i)}var W=new WeakSet,k=new WeakSet;class b{constructor(t){let{settings:i,data:s}=t;r(this,k),r(this,W),this.t=i,this.i=s,this.P=this.i.canvas.element.getContext("2d")}A(t){let i,s,h,n,a,r,o,d;"cover"===this.t.fillMode?({sx:i,sy:s,sWidth:h,sHeight:n,dx:a,dy:r,dWidth:o,dHeight:d}=e(this,W,F).call(this,t)):"contain"===this.t.fillMode&&({sx:i,sy:s,sWidth:h,sHeight:n,dx:a,dy:r,dWidth:o,dHeight:d}=e(this,k,S).call(this,t));const l=this.i.canvas.element;this.t.onBeforeFrame(this.i.pluginApi,{context:this.P,width:l.width,height:l.height}),this.P.drawImage(t,i,s,h,n,a,r,o,d),this.t.onAfterFrame(this.i.pluginApi,{context:this.P,width:l.width,height:l.height})}C(){const t=this.i.canvas.element;this.P.clearRect(0,0,t.width,t.height)}}function F(t){let i,s,h,e,n=this.i.canvas.element.width,a=this.i.canvas.element.height,r=t.naturalWidth,o=t.naturalHeight,d=Math.min(n/r,a/o),l=r*d,u=o*d,c=1;return l<n&&(c=n/l),Math.abs(c-1)<1e-14&&u<a&&(c=a/u),l*=c,u*=c,h=r/(l/n),e=o/(u/a),i=.5*(r-h),s=.5*(o-e),i<0&&(i=0),s<0&&(s=0),h>r&&(h=r),e>o&&(e=o),{sx:i,sy:s,sWidth:h,sHeight:e,dx:0,dy:0,dWidth:n,dHeight:a}}function S(t){let i,s,h=this.i.canvas.element.width,e=this.i.canvas.element.height,n=t.naturalWidth,a=t.naturalHeight,r=n,o=a,d=h/n,l=e/a,u=Math.min(d,l),c=n*u,f=a*u;return i=.5*(h-c),s=.5*(e-f),{sx:0,sy:0,sWidth:r,sHeight:o,dx:i,dy:s,dWidth:c,dHeight:f}}var _=new WeakSet;class y{constructor(i){let{settings:s,data:h,changeFrame:e}=i;r(this,_),t(this,"_isAnimating",void 0),t(this,"_framesLeftToPlay",void 0),t(this,"_lastUpdate",void 0),t(this,"_duration",void 0),t(this,"_stopRequested",void 0),t(this,"_framesQueue",void 0),t(this,"_progressThreshold",void 0),this.t=s,this.i=h,this.D=e,this.H=!1,this.I=!1,this.L=0,this.N=.35,this.q()}O(){this.I=!0,this.H=!1,this.i.isAnyFrameChanged||(this.D(1),Number.isFinite(this.R)&&this.R--),this.j=null,requestAnimationFrame(e(this,_,E).bind(this))}B(){const t=this.I;this.I=!1,this.R=void 0,t&&(this.i.canvas.element.dispatchEvent(new Event(u+"animation-end")),this.t.onAnimationEnd(this.i.pluginApi))}X(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t=Math.floor(t),void 0===i&&(i=this.t.reverse);let s=i?this.i.currentFrame-t:this.i.currentFrame+t;return this.t.loop?s<=0?s=this.i.totalImages-Math.abs(s):s>this.i.totalImages&&(s-=this.i.totalImages):s<=0?(s=1,this.H=!0):s>this.i.totalImages&&(s=this.i.totalImages,this.H=!0),s}q(){this.Y=this.i.totalImages/this.t.fps*1e3}}function E(t){if(!this.I)return;let i;this.j||(this.j=performance.now());let s=Math.abs(t-performance.now())/this.Y>this.N,h=(t-this.j)/this.Y;if(h>this.N&&(s=!0),s?i=1:(h<0&&(h=0),i=h*this.i.totalImages,i+=this.L),i>=1){const h=s?performance.now():t;this.L=i%1,i=Math.floor(i)%this.i.totalImages,i>this.R&&(i=this.R);const e=this.X(i);this.H?(this.i.pluginApi.stop(),this.H=!1,this.i.pluginApi.getCurrentFrame()!==e&&this.D(e)):(this.j=h,this.D(e),void 0!==this.R&&(this.R=this.R-i,this.R<=0&&this.i.pluginApi.stop()))}this.I&&requestAnimationFrame(e(this,_,E).bind(this))}var T=new WeakSet,P=new WeakSet;class x{constructor(i){let{settings:s,data:h,drawFrame:e}=i;r(this,P),r(this,T),t(this,"_imageObject",void 0),t(this,"_isPosterLoaded",void 0),this.t=s,this.i=h,this.A=e,this.$=!1}U(){this.t.poster&&!this.i.isAnyFrameChanged&&(this.G=new Image,this.G.onload=this.G.onerror=e(this,T,A).bind(this),this.G.src=this.t.poster)}J(){!this.i.isAnyFrameChanged&&this.$&&e(this,P,C).call(this)}}function A(t){"error"!==t.type&&(this.$=!0,this.i.canvas.element.dispatchEvent(new Event(u+"poster-loaded")),this.t.onPosterLoaded(this.i.pluginApi),this.i.isAnyFrameChanged||e(this,P,C).call(this))}function C(){this.A(this.G)}var D=new WeakSet,H=new WeakSet,I=new WeakSet,L=new WeakSet,N=new WeakSet,q=new WeakSet;class O{constructor(i){let{data:s,settings:h,changeFrame:n,getNextFrame:a}=i;r(this,q),r(this,N),r(this,L),r(this,I),r(this,H),r(this,D),t(this,"_isSwiping",!1),t(this,"_curX",void 0),t(this,"_curY",void 0),t(this,"_prevX",void 0),t(this,"_prevY",void 0),t(this,"_threshold",void 0),t(this,"_pixelsCorrection",void 0),t(this,"_lastInteractionTime",void 0),t(this,"_prevDirection",void 0),this.i=s,this.t=h,this.D=n,this.X=a,this.K=["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","touchcancel"],this.V=!1,this.Z=e(this,D,R).bind(this),this.tt=0,this.it()}st(){this.K.forEach((t=>{this.i.canvas.element.addEventListener(t,this.Z)}))}ht(){this.K.forEach((t=>{this.i.canvas.element.removeEventListener(t,this.Z)})),document.removeEventListener("mouseup",this.Z),document.removeEventListener("mousemove",this.Z),this.i.canvas.element.style.cursor=null}it(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.et=t||this.i.canvas.element.clientWidth/this.i.totalImages}}function R(t){let i;switch(void 0!==t.touches&&t.touches.length&&(i=t.touches),this.nt=i?i[0].pageX:t.clientX,this.rt=i?i[0].pageY:t.clientY,t.type){case"mousedown":case"touchstart":"touchstart"===t.type&&t.cancelable&&e(this,q,Y).call(this,t),document.addEventListener("mouseup",this.Z),document.addEventListener("mousemove",this.Z),e(this,H,j).call(this);break;case"mousemove":case"touchmove":const i=this.ot!==this.nt&&this.dt!==this.nt;this.V&&i&&e(this,I,z).call(this);break;case"mouseup":case"touchend":case"touchcancel":this.V&&(document.removeEventListener("mouseup",this.Z),document.removeEventListener("mousemove",this.Z),e(this,L,B).call(this))}}function j(){const t=this.i.pluginApi;(t.isFastPreloadFinished()||t.isPreloadFinished())&&(this.t.fastPreview&&!t.isPreloadFinished()&&t.isFastPreloadFinished()&&t.preloadImages(),t.stop(),this.V=!0,this.i.canvas.element.style.cursor="grabbing",this.ot=this.nt,this.dt=this.rt,this.i.canvas.element.dispatchEvent(new CustomEvent(u+"drag-start",{detail:{frame:this.i.currentFrame}})))}function z(){const t=e(this,N,X).call(this);this.lt&&this.lt!==t&&(this.tt=0),this.lt=t;const i=Math.abs(this.nt-this.ot),s=(i+this.tt)*this.t.dragModifier;if(this.ot=this.nt,this.dt=this.rt,"left"!==t&&"right"!==t||s<this.et)return void(this.tt+=i);const h=s/this.i.canvas.element.clientWidth;let n=Math.floor(h*this.i.totalImages);n%=this.i.totalImages,this.tt=(s-this.et*n)/this.t.dragModifier;let a="left"===t;this.t.inversion&&(a=!a),this.D(this.X(n,a)),this.i.canvas.element.dispatchEvent(new CustomEvent(u+"drag-change",{detail:{frame:this.i.currentFrame,direction:t}}))}function B(){this.nt=this.rt=this.ot=this.dt=null,this.V=!1,this.i.canvas.element.style.cursor=null,this.ut=(new Date).getTime(),this.i.canvas.element.dispatchEvent(new CustomEvent(u+"drag-end",{detail:{frame:this.i.currentFrame,direction:this.lt}}))}function X(){let t,i,s=this.ot-this.nt,h=this.dt-this.rt;return t=Math.atan2(h,s),i=Math.round(180*t/Math.PI),i<0&&(i=360-Math.abs(i)),i>=0&&i<=60||i<=360&&i>=300?"left":i>=120&&i<=240?"right":i>=241&&i<=299?"bottom":"up"}function Y(t){if("preventPageScroll"===this.t.touchScrollMode&&t.preventDefault(),"pageScrollTimer"===this.t.touchScrollMode){const i=(new Date).getTime();this.ut&&i-this.ut<this.t.pageScrollTimerDelay?t.preventDefault():this.ut=null}}var $=new WeakMap,Q=new WeakMap,U=new WeakMap,G=new WeakMap,J=new WeakMap,K=new WeakMap,V=new WeakMap,Z=new WeakMap,tt=new WeakSet,it=new WeakSet,st=new WeakSet,ht=new WeakSet,et=new WeakSet,nt=new WeakSet,at=new WeakSet,rt=new WeakSet,ot=new WeakSet,dt=new WeakSet;class lt{constructor(t,h){r(this,dt),r(this,ot),r(this,rt),r(this,at),r(this,nt),r(this,et),r(this,ht),r(this,st),r(this,it),r(this,tt),a(this,$,{writable:!0,value:void 0}),a(this,Q,{writable:!0,value:{currentFrame:1,totalImages:null,loadedImagesArray:[],deferredAction:null,isAnyFrameChanged:!1,pluginApi:void 0,canvas:{element:null,ratio:null}}}),a(this,U,{writable:!0,value:void 0}),a(this,G,{writable:!0,value:void 0}),a(this,J,{writable:!0,value:void 0}),a(this,K,{writable:!0,value:void 0}),a(this,V,{writable:!0,value:void 0}),a(this,Z,{writable:!0,value:void 0}),function(t,i){if(!(t instanceof HTMLCanvasElement))throw new TypeError("node is required and should be canvas element");if(!i.images||!Array.isArray(i.images)||i.images.length<=1)throw new TypeError("options.images is required and must be an array with more than 1 element");"preloadNumber"in i&&(i.preloadNumber=Number.parseInt(i.preloadNumber)),"fillMode"in i&&!["cover","contain"].includes(i.fillMode)&&delete i.fillMode,"dragModifier"in i&&(i.dragModifier=Math.abs(+i.dragModifier))}(t,h),s(this,$,{...l,...h}),i(this,Q).totalImages=i(this,$).images.length,i(this,Q).canvas.element=t,i(this,Q).pluginApi=this,s(this,U,e(this,ht,vt).bind(this)),e(this,tt,ut).call(this)}play(){return i(this,K).I||(i(this,G).v?(i(this,K).O(),i(this,G).T()):(i(this,Q).deferredAction=this.play.bind(this),i(this,G)._())),this}stop(){return i(this,K).B(),this}toggle(){return i(this,K).I?this.stop():this.play(),this}next(){return i(this,G).v?(this.stop(),e(this,it,ct).call(this,i(this,K).X(1)),i(this,G).T()):(i(this,Q).deferredAction=this.next.bind(this),i(this,G)._()),this}prev(){return i(this,G).v?(this.stop(),e(this,it,ct).call(this,i(this,K).X(1,!i(this,$).reverse)),i(this,G).T()):(i(this,Q).deferredAction=this.prev.bind(this),i(this,G)._()),this}setFrame(t){return i(this,G).v?(this.stop(),e(this,it,ct).call(this,o(t,i(this,Q).totalImages)),i(this,G).T()):(i(this,Q).deferredAction=this.setFrame.bind(this,t),i(this,G)._()),this}playTo(t,s){t=o(t,i(this,Q).totalImages);const h=Math.abs(t-i(this,Q).currentFrame),e=i(this,Q).totalImages-h,n=i(this,$).loop&&(null==s?void 0:s.shortestPath)&&e<h;return n?t<i(this,Q).currentFrame?this.setReverse(!1):this.setReverse(!0):t>i(this,Q).currentFrame?this.setReverse(!1):this.setReverse(!0),this.playFrames(n?e:h)}playFrames(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(i(this,G).v){if(t=Math.floor(t),t<0)return this.stop();if(i(this,Q).isAnyFrameChanged||(t+=1),t<=0)return this.stop();i(this,K).R=t,this.play(),i(this,G).T()}else i(this,Q).deferredAction=this.playFrames.bind(this,t),i(this,G)._();return this}setReverse(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return i(this,$).reverse=!!t,this}getReverse(){return i(this,$).reverse}setForward(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return i(this,$).reverse=!t,this}preloadImages(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;return t=t??i(this,$).images.length,i(this,G)._(t),this}updateCanvas(){return e(this,ht,vt).call(this),this}getOption(t){if(t in i(this,$))return i(this,$)[t];console.warn(`${t} is not a valid option`)}setOption(t,s){return["fps","loop","reverse","inversion","ratio","fillMode","draggable","dragModifier","touchScrollMode","pageScrollTimerDelay","onPreloadFinished","onFastPreloadFinished","onPosterLoaded","onAnimationEnd","onBeforeFrame","onAfterFrame"].includes(t)?(i(this,$)[t]=s,"fps"===t&&i(this,K).q(),"ratio"===t&&e(this,ht,vt).call(this),"fillMode"===t&&e(this,ht,vt).call(this),"draggable"===t&&e(this,at,gt).call(this,s),"dragModifier"===t&&(i(this,$).dragModifier=Math.abs(+s))):console.warn(`${t} is not allowed in setOption`),this}getCurrentFrame(){return i(this,Q).currentFrame}getTotalImages(){return i(this,Q).totalImages}getRatio(){return i(this,Q).canvas.ratio}isAnimating(){return i(this,K).I}isDragging(){return!!i(this,Z)&&i(this,Z).V}isPreloadFinished(){return i(this,G).l}isFastPreloadFinished(){return i(this,G).u}isLoadedWithErrors(){return i(this,G).m}reset(){return i(this,G).v?(this.stop(),e(this,it,ct).call(this,o(1,i(this,Q).totalImages)),i(this,G).T()):(i(this,Q).deferredAction=this.reset.bind(this),i(this,G)._()),this}destroy(){this.stop(),i(this,J).C(),e(this,at,gt).call(this,!1),e(this,ot,Mt).call(this,!1)}}function ut(){if(s(this,J,new b({settings:i(this,$),data:i(this,Q)})),s(this,K,new y({settings:i(this,$),data:i(this,Q),changeFrame:e(this,it,ct).bind(this)})),e(this,ht,vt).call(this),i(this,$).poster&&e(this,rt,pt).call(this),e(this,ot,Mt).call(this,!0),s(this,G,new w({settings:i(this,$),data:i(this,Q),updateImagesCount:e(this,et,mt).bind(this),getFramesLeft:e(this,dt,Wt).bind(this)})),"all"===i(this,$).preload||"partial"===i(this,$).preload){let t="all"===i(this,$).preload?i(this,Q).totalImages:i(this,$).preloadNumber;0===t&&(t=i(this,Q).totalImages),i(this,G)._(t)}i(this,$).autoplay&&this.play(),i(this,$).draggable&&e(this,at,gt).call(this,!0)}function ct(t){t===i(this,Q).currentFrame&&i(this,Q).isAnyFrameChanged||(i(this,Q).isAnyFrameChanged||(i(this,Q).isAnyFrameChanged=!0),e(this,st,ft).call(this,t),i(this,Q).currentFrame=t)}function ft(t){i(this,J).C(),i(this,J).A(i(this,Q).loadedImagesArray[t-1])}function vt(){const t=i(this,Q).canvas;i(this,$).ratio?t.ratio=i(this,$).ratio:t.ratio||(t.ratio=t.element.width/t.element.height);const s=window.devicePixelRatio.toFixed(2)||1;let h=i(this,$).responsiveAspect,n="client"+d(h),a="width"===h?"height":"width",r="client"+d(a);const o=t.element[n];t.element[h]=t.element[n]*s,o!==t.element[n]&&(t.element[h]=t.element[n]*s);let l="width"===h?t.element.clientWidth/t.ratio:t.element.clientHeight*t.ratio;t.element[a]=Math.round(l)*s;const u=Math.abs(t.element[a]-t.element[r]*s);if(u>s){let i=t.element.clientWidth/t.element.clientHeight;Math.abs(t.ratio-i)/t.ratio>.01?(t.element[a]=t.element[r]*s,t.ratio=i):t.element[a]="width"===h?t.element.width/t.ratio:t.element.height*t.ratio}else u>0&&u<=s&&(t.element[a]="width"===h?t.element.width/t.ratio:t.element.height*t.ratio);i(this,Z)&&i(this,Z).it(),e(this,nt,wt).call(this)}function mt(){i(this,Z)&&i(this,Z).it(),i(this,K).q()}function wt(){i(this,Q).isAnyFrameChanged?e(this,st,ft).call(this,i(this,Q).currentFrame):i(this,V)&&i(this,V).J()}function gt(t){t?(i(this,Z)||s(this,Z,new O({data:i(this,Q),settings:i(this,$),changeFrame:e(this,it,ct).bind(this),getNextFrame:i(this,K).X.bind(i(this,K))})),i(this,Z).st()):i(this,Z)&&i(this,Z).ht()}function pt(){i(this,V)||s(this,V,new x({settings:i(this,$),data:i(this,Q),drawFrame:i(this,J).A.bind(i(this,J))})),i(this,V).U()}function Mt(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?window.addEventListener("resize",i(this,U)):window.removeEventListener("resize",i(this,U))}function Wt(){return i(this,K).R}export{lt as default};
//# sourceMappingURL=animate-images.esm.min.js.map
